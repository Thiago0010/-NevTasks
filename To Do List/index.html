<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NevTasks Pro ‚Äî Lista de Tarefas Completa</title>
<style>
  :root{--bg:#0b1220;--card:#0f1724;--muted:#94a3b8;--text:#e6eef8;--accent:#60a5fa;--ok:#10b981;--danger:#f43f5e}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,Roboto,system-ui,-apple-system,"Segoe UI",Arial;background:linear-gradient(180deg,#071029 0%,#071a2b 100%);color:var(--text);min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:28px}
  .app{width:100%;max-width:1100px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:14px;padding:18px;box-shadow:0 12px 40px rgba(2,6,23,0.6);display:grid;grid-template-columns:320px 1fr;gap:16px}
  header{grid-column:1/-1;display:flex;align-items:center;gap:12px}
  h1{margin:0;font-size:20px}
  .left{padding:12px;background:rgba(255,255,255,0.02);border-radius:12px}
  .projects{display:flex;flex-direction:column;gap:8px;margin-top:10px}
  .project{padding:8px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
  .project.active{background:rgba(96,165,250,0.12)}
  .controls{display:flex;gap:8px;align-items:center;margin-left:auto}
  .search{padding:8px;border-radius:10px;border:none;background:rgba(255,255,255,0.03);color:var(--text)}
  .topbar-actions button{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:var(--text);cursor:pointer}

  .main{padding:12px;background:rgba(255,255,255,0.02);border-radius:12px;min-height:420px}
  .add-row{display:flex;gap:8px}
  input,select,textarea{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.03);color:var(--text);padding:8px;border-radius:8px}
  .task-list{margin-top:14px;display:flex;flex-direction:column;gap:10px}
  .task{display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.02));box-shadow:0 4px 8px rgba(2,6,23,0.35)}
  .task .left-col{width:40px;display:flex;flex-direction:column;align-items:center}
  .circle{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer}
  .task .content{flex:1}
  .task .meta{font-size:12px;color:var(--muted);margin-top:6px}
  .badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px}
  .priority-low{background:rgba(16,185,129,0.08);color:var(--ok)}
  .priority-med{background:rgba(96,165,250,0.08);color:var(--accent)}
  .priority-high{background:rgba(244,63,94,0.08);color:var(--danger)}
  .subtasks{margin-top:8px;padding-left:6px}
  .tiny{font-size:12px;color:var(--muted)}
  .right-actions{display:flex;flex-direction:column;gap:8px;align-items:flex-end}
  .pill{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:13px}
  .stats{padding:10px;border-radius:10px;background:rgba(255,255,255,0.01);margin-top:12px}
  footer{grid-column:1/-1;margin-top:8px;text-align:center;color:var(--muted);font-size:13px}

  /* responsive */
  @media(max-width:980px){.app{grid-template-columns:1fr;}.left{order:2}.main{order:1}}

  /* animations */
  .fade-in{animation:fadeIn .2s ease}
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

  /* modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center}
  .modal{background:var(--card);padding:16px;border-radius:12px;width:420px}
  .row{display:flex;gap:8px;align-items:center}
</style>
</head>
<body>
  <div class="app">
    <header>
      <div style="display:flex;align-items:center;gap:12px">
        <h1>NevTasks Pro</h1>
        <div class="tiny">Completo ‚Äî offline-first, multi-funcional</div>
      </div>

      <div class="controls">
        <input id="search" class="search" placeholder="Pesquisar tarefas...">
        <div class="topbar-actions">
          <button id="importBtn">Import</button>
          <button id="exportBtn">Export</button>
          <button id="themeBtn">Tema</button>
        </div>
      </div>
    </header>

    <aside class="left">
      <div style="display:flex;gap:8px;align-items:center">
        <input id="newProjectName" placeholder="Nova categoria" />
        <button id="addProjectBtn">Adicionar</button>
      </div>
      <div class="projects" id="projects"></div>

      <div class="stats" id="stats"></div>

      <div style="margin-top:12px">
        <button id="exportClipboard">Sync (copy JSON)</button>
        <button id="importClipboard">Load JSON</button>
      </div>
    </aside>

    <main class="main">
      <div style="display:flex;gap:8px;align-items:flex-start" class="add-row">
        <input id="newText" placeholder="O que voc√™ precisa fazer?" style="flex:1" />
        <select id="newPriority"><option value="med">Prioridade: M√©dia</option><option value="low">Baixa</option><option value="high">Alta</option></select>
        <input id="newDue" type="datetime-local" />
        <button id="addTaskBtn">Adicionar</button>
      </div>

      <div style="display:flex;gap:8px;margin-top:10px;align-items:center">
        <select id="filterSelect"><option value="all">Todos</option><option value="active">Ativas</option><option value="done">Conclu√≠das</option><option value="overdue">Atrasadas</option></select>
        <select id="sortSelect"><option value="created">Ordenar: Criadas</option><option value="due">Ordenar: Data</option><option value="priority">Ordenar: Prioridade</option></select>
        <div style="margin-left:auto;font-size:13px" id="currentProjectLabel">Projeto: Inbox</div>
      </div>

      <div id="taskList" class="task-list"></div>
    </main>

    <div class="modal-backdrop" id="modalBackdrop">
      <div class="modal">
        <h3>Editar tarefa</h3>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <input id="editText" />
          <textarea id="editNotes" rows="4" placeholder="Notas / descri√ß√£o"></textarea>
          <div class="row"><label>Prioridade</label><select id="editPriority"><option value="low">Baixa</option><option value="med">M√©dia</option><option value="high">Alta</option></select></div>
          <div class="row"><label>Data</label><input id="editDue" type="datetime-local" /></div>
          <div style="display:flex;gap:8px;justify-content:flex-end">
            <button id="closeModal">Cancelar</button>
            <button id="saveModal">Salvar</button>
          </div>
        </div>
      </div>
    </div>

    <footer>NevTasks Pro ‚Äî offline-first ‚Ä¢ BroadcastChannel sync ‚Ä¢ Export/Import JSON</footer>
  </div>

<script>
// Data model and utils
const uid = (p='id') => p + Date.now().toString(36) + Math.random().toString(36).slice(2,6)
let state = { tasks: [], projects: ['Inbox'], selectedProject: 'Inbox' }
const STORAGE_KEY = 'nev_tasks_pro_v1'

// UI refs
const $ = id => document.getElementById(id)
const projectsEl = $('projects'), taskListEl = $('taskList'), statsEl = $('stats'), currentProjectLabel = $('currentProjectLabel')

// Init
function load(){
  const raw = localStorage.getItem(STORAGE_KEY)
  if(raw){ try{ state = JSON.parse(raw) }catch(e){ console.error(e) }}
  if(!state.projects || !state.tasks) { state.projects = ['Inbox']; state.tasks = [] }
}
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)) }

// BroadcastChannel sync
let bc = null
try{ bc = new BroadcastChannel('nev_tasks_channel'); bc.onmessage = (e)=>{ if(e.data && e.data.type==='sync'){ state = e.data.state; render(); save(); } } }catch(e){ bc=null }
function broadcast(){ if(bc) bc.postMessage({type:'sync', state}) }

// Notifications
if('Notification' in window && Notification.permission !== 'granted') Notification.requestPermission()
function notify(title, body){ if('Notification' in window && Notification.permission === 'granted'){ new Notification(title, { body }) } }

// Reminders checker
setInterval(()=>{
  const now = Date.now()
  state.tasks.forEach(t=>{
    if(t.dueAt && !t._reminded && new Date(t.dueAt).getTime() <= now){
      notify('Lembrete: ' + t.text, `Projeto: ${t.project || 'Inbox'}`)
      t._reminded = true
      save(); broadcast();
    }
  })
}, 30000)

// CRUD for projects
function renderProjects(){
  projectsEl.innerHTML = ''
  state.projects.forEach(p=>{
    const div = document.createElement('div'); div.className='project' + (p===state.selectedProject? ' active':''); div.onclick = ()=>{ state.selectedProject=p; render(); }
    div.innerHTML = `<div style=flex:1>${p}</div><div style='display:flex;gap:6px'><button data-proj='${p}' class='editProj'>‚úèÔ∏è</button><button data-proj='${p}' class='delProj'>üóëÔ∏è</button></div>`
    projectsEl.appendChild(div)
  })
}

function addProject(name){ if(!name) return; if(state.projects.includes(name)) return alert('Projeto j√° existe'); state.projects.push(name); save(); render(); broadcast(); }
function removeProject(name){ if(name==='Inbox') return alert('N√£o pode remover Inbox'); if(!confirm('Remover projeto '+name+' e mover tarefas para Inbox?')) return; state.tasks.forEach(t=>{ if(t.project===name) t.project='Inbox' }); state.projects = state.projects.filter(p=>p!==name); if(state.selectedProject===name) state.selectedProject='Inbox'; save(); render(); broadcast(); }

document.getElementById('addProjectBtn').onclick = ()=>{ const v = document.getElementById('newProjectName').value.trim(); if(v) addProject(v); document.getElementById('newProjectName').value=''; }
projectsEl.addEventListener('click', (e)=>{ if(e.target.classList.contains('delProj')) removeProject(e.target.dataset.proj); if(e.target.classList.contains('editProj')){ const newName = prompt('Novo nome', e.target.dataset.proj); if(newName){ state.projects = state.projects.map(p=> p===e.target.dataset.proj? newName : p); state.tasks.forEach(t=>{ if(t.project===e.target.dataset.proj) t.project=newName }); save(); render(); broadcast(); } } })

// Tasks
function addTask({text, priority='med', dueAt=null, project=null}){
  if(!text) return alert('Digite uma tarefa')
  const t = { id: uid('t'), text, notes:'', done:false, priority, project: project || state.selectedProject || 'Inbox', createdAt: Date.now(), dueAt: dueAt || null, subtasks: [], tags: [] }
  state.tasks.unshift(t); save(); render(); broadcast(); }

function toggleDone(id){ const t = state.tasks.find(x=>x.id===id); if(t){ t.done=!t.done; save(); render(); broadcast(); } }
function deleteTask(id){ if(!confirm('Remover tarefa?')) return; state.tasks = state.tasks.filter(x=>x.id!==id); save(); render(); broadcast(); }
function editTask(id, data){ const t = state.tasks.find(x=>x.id===id); if(!t) return; Object.assign(t,data); save(); render(); broadcast(); }

// Subtasks
function addSubtask(taskId, text){ const t = state.tasks.find(x=>x.id===taskId); if(!t) return; t.subtasks.push({ id: uid('s'), text, done:false }); save(); render(); broadcast(); }
function toggleSubtask(taskId, subId){ const t = state.tasks.find(x=>x.id===taskId); const s = t.subtasks.find(s=>s.id===subId); s.done=!s.done; save(); render(); broadcast(); }
function removeSubtask(taskId, subId){ const t = state.tasks.find(x=>x.id===taskId); t.subtasks = t.subtasks.filter(s=>s.id!==subId); save(); render(); broadcast(); }

// Render
function render(){
  renderProjects();
  currentProjectLabel.textContent = 'Projeto: ' + state.selectedProject
  renderStats();
  const q = document.getElementById('search').value.trim().toLowerCase();
  const filter = document.getElementById('filterSelect').value;
  const sort = document.getElementById('sortSelect').value;

  let list = state.tasks.filter(t=> t.project === state.selectedProject )
  if(filter==='active') list = list.filter(t=>!t.done)
  if(filter==='done') list = list.filter(t=>t.done)
  if(filter==='overdue') list = list.filter(t=> t.dueAt && new Date(t.dueAt).getTime() < Date.now() && !t.done)
  if(q) list = list.filter(t=> t.text.toLowerCase().includes(q) || (t.notes && t.notes.toLowerCase().includes(q)) )

  if(sort==='due') list.sort((a,b)=>{ if(!a.dueAt) return 1; if(!b.dueAt) return -1; return new Date(a.dueAt)-new Date(b.dueAt) })
  if(sort==='priority') {
    const rank = { high:0, med:1, low:2 }
    list.sort((a,b)=> rank[a.priority]-rank[b.priority] )
  }

  taskListEl.innerHTML = ''
  list.forEach(t=>{
    const el = document.createElement('div'); el.className='task fade-in'
    el.innerHTML = `
      <div class='left-col'>
        <div class='circle' data-id='${t.id}'>${t.done? '‚úîÔ∏è' : ''}</div>
        <div class='tiny'>${t.priority}</div>
      </div>
      <div class='content'>
        <div style='display:flex;gap:8px;align-items:center'>
          <div style='font-weight:700'>${escapeHtml(t.text)}</div>
          ${t.dueAt ? `<div class='pill tiny'>‚è∞ ${new Date(t.dueAt).toLocaleString()}</div>` : ''}
          <div style='margin-left:auto' class='tiny'>${t.tags && t.tags.length? t.tags.join(', '): ''}</div>
        </div>
        <div class='meta'>Criada: ${new Date(t.createdAt).toLocaleString()} ‚Ä¢ Projeto: ${t.project} ${t.notes? '‚Ä¢ ' + t.notes.slice(0,80): ''}</div>
        ${t.subtasks && t.subtasks.length? '<div class="subtasks">' + t.subtasks.map(s=>`<div class='tiny'><input type=checkbox data-sub='${s.id}' data-task='${t.id}' ${s.done? 'checked':''}> ${escapeHtml(s.text)}</div>`).join('') + '</div>' : ''}
      </div>
      <div class='right-actions'>
        <div style='display:flex;flex-direction:column;gap:6px'>
          <button data-edit='${t.id}'>‚úèÔ∏è</button>
          <button data-del='${t.id}'>üóëÔ∏è</button>
          <button data-addsub='${t.id}'>Ôºã Sub</button>
        </div>
      </div>
    `
    taskListEl.appendChild(el)
  })

  // attach listeners
  document.querySelectorAll('.circle').forEach(el=> el.onclick = ()=> toggleDone(el.dataset.id))
  document.querySelectorAll('[data-del]').forEach(btn=> btn.onclick = ()=> deleteTask(btn.dataset.del))
  document.querySelectorAll('[data-edit]').forEach(btn=> btn.onclick = ()=> openEditModal(btn.dataset.edit))
  document.querySelectorAll('[data-addsub]').forEach(btn=> btn.onclick = ()=>{ const text = prompt('Texto da subtarefa'); if(text) addSubtask(btn.dataset.addsub, text) })
  document.querySelectorAll('input[type=checkbox][data-sub]').forEach(cb=> cb.onchange = ()=> toggleSubtask(cb.dataset.task, cb.dataset.sub))
}

function renderStats(){
  const total = state.tasks.filter(t=> t.project===state.selectedProject).length
  const done = state.tasks.filter(t=> t.project===state.selectedProject && t.done).length
  const overdue = state.tasks.filter(t=> t.project===state.selectedProject && t.dueAt && !t.done && new Date(t.dueAt).getTime() < Date.now()).length
  statsEl.innerHTML = `Total: ${total} ‚Ä¢ Conclu√≠das: ${done} ‚Ä¢ Atrasadas: ${overdue}`
}

// Utils
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]) }

// Modal edit
const modal = $('modalBackdrop'), editText = $('editText'), editNotes = $('editNotes'), editPriority = $('editPriority'), editDue = $('editDue')
let editingId = null
function openEditModal(id){ const t = state.tasks.find(x=>x.id===id); if(!t) return; editingId=id; editText.value=t.text; editNotes.value=t.notes||''; editPriority.value=t.priority||'med'; editDue.value=t.dueAt? new Date(t.dueAt).toISOString().slice(0,16):''; modal.style.display='flex' }
$('closeModal').onclick = ()=>{ modal.style.display='none' }
$('saveModal').onclick = ()=>{ const t = state.tasks.find(x=>x.id===editingId); if(!t) return; t.text = editText.value; t.notes = editNotes.value; t.priority = editPriority.value; t.dueAt = editDue.value || null; modal.style.display='none'; save(); render(); broadcast(); }

// UI hooks
document.getElementById('addTaskBtn').onclick = ()=>{ addTask({ text: document.getElementById('newText').value, priority: document.getElementById('newPriority').value, dueAt: document.getElementById('newDue').value }); document.getElementById('newText').value=''; document.getElementById('newDue').value=''; }

document.getElementById('search').oninput = ()=> render()
document.getElementById('filterSelect').onchange = ()=> render()
document.getElementById('sortSelect').onchange = ()=> render()

// Import/Export
$('exportBtn').onclick = ()=>{ const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='nevtasks-export.json'; a.click(); URL.revokeObjectURL(url) }
$('importBtn').onclick = ()=>{ const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json'; inp.onchange = e => { const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = ()=>{ try{ const data = JSON.parse(r.result); if(data.tasks && data.projects){ state = data; save(); render(); broadcast(); alert('Importado') } else alert('Arquivo inv√°lido') }catch(err){ alert('Erro ao ler arquivo') } }; r.readAsText(f) }; inp.click(); }

// Clipboard sync simple
$('exportClipboard').onclick = async ()=>{ await navigator.clipboard.writeText(JSON.stringify(state)); alert('JSON copiado: cole em outro dispositivo') }
$('importClipboard').onclick = async ()=>{ try{ const txt = await navigator.clipboard.readText(); const data = JSON.parse(txt); if(data.tasks){ state = data; save(); render(); broadcast(); alert('Importado do clipboard') } }catch(e){ alert('Falha ao importar do clipboard') } }

// Theme toggle (simple)
let dark = true
$('themeBtn').onclick = ()=>{ dark = !dark; document.documentElement.style.background = dark? '': '#fff'; alert('Troquei o tema (simplificado)') }

// Load/initial render
load(); render();

// simple examples: create sample data if empty
if(state.tasks.length===0){ addTask({text:'Bem-vindo ao NevTasks Pro ‚Äî Crie sua primeira tarefa', priority:'med'}); addTask({text:'Teste lembrete em 1 minuto', priority:'high', dueAt: new Date(Date.now()+60000).toISOString().slice(0,16) }); }

</script>
</body>
</html>